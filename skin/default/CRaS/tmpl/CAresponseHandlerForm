<script language="JavaScript">

function sendForm(form){
   $.ajax({
       type: "POST",
       data: form,
       dataType: "json",
       url: window.location.pathname,
       headers: {'Content-Type': 'application/x-www-form-urlencoded'},
       contentType: 'application/x-www-form-urlencoded; charset=utf-8',
       success: function(data) {
          console.log("data=",data);
          var t=JSON.stringify(data,undefined,2);
          t=t.replace(/\\n/g,"\n      ");
          $("#result").text(t);
          $("#msgbox").show();
          var exitmsg=data.exitmsg;
          if (data.exitcode!=0){
             exitmsg="ERROR: <font color=red>"+exitmsg+"</font>";
          }
          else{
             exitmsg="<font color=green>"+exitmsg+"</font>";
          }
          $("#exitmsg").html("<b>"+exitmsg+"</b>");
       },
       error: function(e) {
           console.log("e=",e);
       //    alert('error handling here');
       }
   });
}

$(document).ready(function(){
   $("#mailtext").focus();
   $("#doPost").click(function(){
      var form=$("#form");
      console.log("form="+form.serialize());

      $("#resultset").height(100);
      $("#resultset").show();
      $("#result").text("");

      // var formobj=new FormData(form[0]);
      // console.log("formobj",formobj);

      var mailtext=$('#mailtext').val();
      var certfile=$('#certfile')[0].files[0];

      if (certfile){
         var reader = new FileReader();

         console.log("fifi indirect send");
         reader.onload = function(e){
                console.log("f=",e.target.result);
            sendForm({mailtext:mailtext,certfile:e.target.result});
         };
         reader.readAsText(certfile);
      }
      else{
         console.log("fifi direct send");
         sendForm({mailtext:mailtext});
      }
   });
});

</script>
<style>
fieldset{
   background:#eee;
}
legend{
  margin-top: 19px;
  font-weight: bold;
  background: #ddd;
  border: 1px solid #999;
}
xlabel{
   display: inline-block;
   text-align: right;
   float: left;
   width:200px;
}

#form input{  
    xdisplay: inline-block;
    text-align: left;
    xfloat: left;
    xwidth:200px;
    xmargin-left:10px;
}

form{
   width:540px;
   margin: 0 auto;
}
fieldset > div{
   margin:5px;
}

</style>
<form id=form>
<h1>CA Resonse Handler</h1>

<fieldset>
<legend>Mail</legend>
<div>
<label for="mailtext">Mailtext:</label>
<textarea rows=8 id=mailtext name=mailtext style="width:100%">


Die wichtigsten Informationen zu Ihrem Zertifikat im Überblick:

Referenznummer: 295432
CommonName: shopplaner.telekom.de
Ausgestellt am: 11.10.2021
Gültig bis: 15.10.2022
Service-Passwort: juROvUmU62
Seriennummer (hex): 3110773c05851a2192371871b6f00d0e
Bestellung /Kontierung:      ICTO-16152

Prüfen Sie, ob der Zertifikatsinhalt Ihrer Beauftragung entspricht und installieren Sie erst dann das Zertifikat in der Serverapplikation.

Wichtiger Hinweis:
Verwahren Sie diese Auftragsbestätigung sorgfältig. Sie enthält wichtige Angaben, die Sie für weitere Aktionen (z.B. Erneuerung, Sperrung) unbedingt benötigen!




-----BEGIN CERTIFICATE-----
MIIJ0zCCCLugAwIBAgIQMRB3PAWFGiGSNxhxtvANDjANBgkqhkiG9w0BAQsFADCB
3zELMAkGA1UEBhMCREUxJTAjBgNVBAoMHFQtU3lzdGVtcyBJbnRlcm5hdGlvbmFs
IEdtYkgxHzAdBgNVBAsMFlQtU3lzdGVtcyBUcnVzdCBDZW50ZXIxHDAaBgNVBAgM
E05vcmRyaGVpbiBXZXN0ZmFsZW4xDjAMBgNVBBEMBTU3MjUwMRAwDgYDVQQHDAdO
ZXRwaGVuMSAwHgYDVQQJDBdVbnRlcmUgSW5kdXN0cmllc3RyLiAyMDEmMCQGA1UE
AwwdVGVsZVNlYyBTZXJ2ZXJQYXNzIENsYXNzIDIgQ0EwHhcNMjExMDExMTIzMTA4
WhcNMjIxMDE1MjM1OTU5WjCBhjELMAkGA1UEBhMCREUxITAfBgNVBAoTGERldXRz
Y2hlIFRlbGVrb20gSVQgR21iSDEXMBUGA1UECxMOVGVsZWtvbS1JVCBQVkcxDDAK
BgNVBAgTA05SVzENMAsGA1UEBxMEQm9ubjEeMBwGA1UEAxMVc2hvcHBsYW5lci50
ZWxla29tLmRlMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAwV36Urpw
TDyJ3pCdbX1TqtLIbFhyI1xDfh4Y0hIJmJhEfYfj4su52dBTZQUdiItm6sHOuDUz
Wq8VIxxHOO+dUBLRaxWfPTDUKb9IkJrW7yBMdFGHcxv/puh6B6T4xabrcOyYfYg3
tq+BTY0efq3JOug79p6ArbYYc/6/kuEb4+w7StooMX5Sx2ro5Ir1e9BheW7D+B16
qaOa+wwttirGgSqqRekyNvDuFaWVE2F5LWhAiZmqC2M1K+HcGV019jrnwyQC7tGs
5OmVRcYaybFyQHifCoKiHG5Evtfr7VYOPx+XHwkFjX8NDO3mJf7bJPi+QokQNZV7
G+ydvv+RGZoE5w4ay2fvlrH4bBVvE/p9YSNEwJU32Aif072IxxYYjPRH2qjMPXQt
4nedCtlvDngzGqstxj+IqJW1YQWh/B2F0aYaUzmw+RxIeH0azZo0x7EsDniXfxq1
mN5uaJI7TIccuDKeGvZcsQQh1DEaC+MnB+vXYyGsjDuVVJ8LcZtombzVfyMHLe6H
R8h4Qw6JWyopyuWa8mSRs4m/R44l3GNr1NVnP2AhikzsmLU4LOyhtTMkPFQCtYHu
7a0cOBH4E1S2al82ejTapXAh7mW+rin1m2xRXlGY4Wmwq26IMfm0sM5EVQrYT+Fn
isJSCdZdg9/niA0NpJOtcsf8GVZiyZjWpjECAwEAAaOCBOAwggTcMB8GA1UdIwQY
MBaAFJTIdEb1OrRGSCb4K8o0HlYmBBIAMA4GA1UdDwEB/wQEAwIFoDAdBgNVHSUE
FjAUBggrBgEFBQcDAgYIKwYBBQUHAwEwHQYDVR0OBBYEFOlbXFv7uDqH1lRJZZTu
04b5/fcQMGUGA1UdIAReMFwwUAYKKwYBBAG9Rw0XATBCMEAGCCsGAQUFBwIBFjRo
dHRwOi8vZG9jcy5zZXJ2ZXJwYXNzLnRlbGVzZWMuZGUvY3BzL3NlcnZlcnBhc3Mu
aHRtMAgGBmeBDAECAjBLBgNVHR8ERDBCMECgPqA8hjpodHRwOi8vY3JsLnNlcnZl
cnBhc3MudGVsZXNlYy5kZS9ybC9TZXJ2ZXJQYXNzX0NsYXNzXzIuY3JsMIGZBggr
BgEFBQcBAQSBjDCBiTAzBggrBgEFBQcwAYYnaHR0cDovL29jc3Auc2VydmVycGFz
cy50ZWxlc2VjLmRlL29jc3ByMFIGCCsGAQUFBzAChkZodHRwOi8vY3JsLnNlcnZl
cnBhc3MudGVsZXNlYy5kZS9jcnQvVGVsZVNlY19TZXJ2ZXJQYXNzX0NsYXNzXzJf
Q0EuY2VyMAwGA1UdEwEB/wQCMAAwIAYDVR0RBBkwF4IVc2hvcHBsYW5lci50ZWxl
a29tLmRlMIIC6QYKKwYBBAHWeQIEAgSCAtkEggLVAtMAdgBvU3asMfAxGdiZAKRR
Ff93FRwR2QLBACkGjbIImjfZEwAAAXxvVdoqAAAEAwBHMEUCIE9tP9Uu/DZM66ju
d1cAROr8f3HDnWUp2zD9IUBUk520AiEAkCLoZ1zk5HTq5KXjHnt+II3axtVtA10N
FeR/wGkx4nMAdQBGpVXrdfqRIDC1oolp9PN9ESxBdL79SbiFq/L8cP5tRwAAAXxv
VdoZAAAEAwBGMEQCIFuFzGOeYs4ZrDChWo2r1YlWDDx7QPVpuzsIotUjiLKUAiBN
sBerZqvwNvS6y1xNav9Cj2BzYu51jo7500sbzrypeQB3AEHIyrHfIkZKEMahOglC
h15OMYsbA+vrS8do8JBilgb2AAABfG9V2lYAAAQDAEgwRgIhAKRcZPV/pgoaYLFS
Bp/7mWCp8X11RiALzr9ROcwWiZq0AiEAh+gcTOSHD16L4oVh/vqRf3O6okSDHW5e
ypbt41yftt8AdwBVgdTCFpA2AUrqC5tXPFPwwOQ4eHAlCBcvo6odBxPTDAAAAXxv
VdsaAAAEAwBIMEYCIQCXQMMI+WkAo1Z6yvAP5CVLqSDyXWlCpt04IKOnnjgqFAIh
AIIua9Jp+3PH7MlhPiT0LvpdZZs6x4RcFXJbEBjSFrzrAHcAUaOw9f0BeZxWbbg3
eI8MpHrMGyfL956IQpoN/tSLBeUAAAF8b1XbWwAABAMASDBGAiEA/6r0hS+9BSgY
9NJadLsV91G8QIemK7cEXZOOPs3253cCIQDZO+9nMCbM88O/vjddkl/R3PANJk3/
xfvNZ/5bbe1sdgB3ACl5vvCeOTkh8FZzn2Old+W+V32cYAr4+U1dJlwlXceEAAAB
fG9V2/AAAAQDAEgwRgIhAK/hL6k2Xw72MVbrUKZH/2FST6ffnG7zn8kUFYSxS1Ee
AiEAgEN0XbNHtnlCgVZQwIDOCsCkh36SamjN6XfQZvIYroEwDQYJKoZIhvcNAQEL
BQADggEBALrFEk20mtJnDTIu+BvynK+Z/PoIGDf5pRAA2bvddQi01pcFlmqRGWoh
h4jEA5rIkYF7tvalNHmmXUxJKBpDv2NilkBSbHu8dqFGDGMQs0156tfHOZA/AoKB
4fFPQj2QvkB/CDh989Q3Le+SwjrSCPVc6+wdiz+oVJE4MSIhH0zkn9gUppDVV5Vj
yJOTTlLN/hnWjkIfZftrmq1mQcTbKYcxCGtx3YPbi+sJ83UhSvcJE+BhhqxYiRA3
EJzsM6Kv2HSkTDsU/JSczqs2+UC+Yu7DHDuD2i2SsrSUKH2lcNsjtC7AzRmyhmVB
UeWjtzp9PfvVFvIFRRRSM5Qu7LExU3w=
-----END CERTIFICATE-----


</textarea>
</div>
 
<div>
<label for="certfile">CertFile:</label>
<input type=file id=certfile name=certfile>
</div>
</fieldset>
 
<br>
<input id=doPost type=button style="text-align:center;width:100%;margin:0px" value="%TRANSLATE(process,CRaS::csr)%">
<br>
<br>
</form>

<center>
<fieldset id=msgbox style="display:none;width:400px">
<legend>Message</legend>
<div id=exitmsg style="text-align:left"></div>
</fieldset>
<fieldset id=resultset style="display:none;overflow-y:auto;width:80%;text-align:left">
<legend>Result</legend>
<xmp id=result style="width:600px">
</xmp>
</fieldset>
</center>


